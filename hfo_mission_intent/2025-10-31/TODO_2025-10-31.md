# Alignment TODO — 2025-10-31

BLUF: Align Swarmlord orchestration, LLM-per-stage across PREY, validators/quorum, stigmergy, and a validated digest in strict agreement with mission intent v1 and Clarification Passes 1–5.

References
- Mission intent: `hfo_mission_intent/2025-10-31/mission_intent_2025-10-31.v1.yml`
- Clarification Passes: 1–5 under `hfo_mission_intent/2025-10-31/`
- Blackboard: `hfo_blackboard/obsidian_synapse_blackboard.jsonl`
- Pilot runner: `scripts/crew_ai/runner.py`
- ARC swarm: `scripts/crew_ai/arc_swarm_runner.py`
- OpenRouter client: `scripts/crew_ai/llm_client.py`
- Validator: `scripts/crew_ai/validate_run.py`

---

## Plan for today (SSOT-first, then generate downstream)

### 1) Upstream SSOT (Gen22) — lock contracts and acceptance

- [ ] Finalize Gen22 SSOT contracts in `hfo_gem/gen_22/crew_ai_swarm_ssot_gen22.md`
  - Artifact schemas per stage include: trace_id, parent_refs, evidence_hashes, context_notes (≥3 lines)
  - Lane artifacts: add explicit keys for engage: tests_green, tripwires_passed, evidence_refs_present
  - Run-level: define `quorum_report.yml` schema (validators, threshold, votes, attestation, evidence_refs)
  - Digest: define validation checklist fields (bluf_present, matrix_present, diagrams_present, diagrams_parser_safe, executive_summary_present, evidence_refs_complete)
  - Per-stage LLM defaults and transport resiliency (retry_on_empty=1; drop response_format on retry; reasoning high when supported)
  - Stigmergy: signals (labels/tags, scores) and TTL policy (evaporation)

- [ ] Export SSOT → schemas for validators
  - Write `scripts/crew_ai/schemas/gen22_lane_artifacts.schema.yml`
  - Write `scripts/crew_ai/schemas/quorum_report.schema.yml`

- [ ] SSOT acceptance anchors
  - Ensure references align with `hfo_mission_intent/2025-10-31/mission_intent_2025-10-31.v1.yml` (per_stage_defaults, stigmergy, mesh quorum)
  - Update parser-safe diagrams if needed (keep labels simple)

### 2) Generate downstream — code and adapters

- [ ] Runner alignment (`scripts/crew_ai/runner.py`)
  - Emit traceability fields on all artifacts; include context_notes (≥3)
  - Add `quorum_report.yml` at run-level; include votes and attestation
  - Add digest validation checklist section in `swarmlord_digest.md`
  - Read mission per-stage LLM defaults and resiliency flags; apply across PREY (esp. Engage)

- [ ] Validator alignment (`scripts/crew_ai/validate_run.py`)
  - Add a Gen22 mode or extend checks to enforce new schemas and digest checklist

- [ ] ARC adapter alignment (`scripts/crew_ai/arc_swarm_runner.py`)
  - Emit traceability fields and context_notes (≥3); read per-stage defaults

- [ ] Stigmergy receipts
  - Add signals and TTL to blackboard receipts (append-only JSONL)

- [ ] OTEL spans per-stage
  - Emit spans for Orchestrate + each PREY phase with model, max_tokens, reasoning flags, latency_ms

### 3) Canary and validation

- [ ] Canary run: ARC validation split (limit=50, seed=42), lanes=10/max_workers=10
  - Expect: lane-level validator PASS, `quorum_report.yml` written, digest checklist PASS

### 4) Docs touch-ups

- [ ] README/AGENTS updates for Gen22
  - Document SSOT-first posture, stigmergy signals, quorum report, and digest checklist

### 5) Minimal tests

- [ ] Validator smoke tests
  - Generate tiny sample artifacts and assert PASS/FAIL on presence/absence of context_notes and evidence_refs

---

## Acceptance gates (quick)
- Lane artifacts satisfy `prey_artifacts` required fields and context_notes ≥ 3 lines.
- Lane-level validator PASS is recorded; run-level quorum PASS/FAIL written with attestation and votes.
- Digest validation PASS recorded (BLUF, matrix, parser-safe diagrams, executive summary, evidence_refs).
- Stigmergy receipts include signals and TTL; OTEL spans show per-stage model and token caps.

Notes
- Safety: chunk ≤ 200 lines, placeholder ban, receipts on material actions.
- Verify is deterministic and independent; LLM may annotate but not decide PASS/FAIL.
