# Alignment TODO â€” 2025-10-31

BLUF: Align Swarmlord orchestration, LLM-per-stage across PREY, validators/quorum, stigmergy, and a validated digest in strict agreement with mission intent v1 and Clarification Passes 1â€“5.

References
- Mission intent: `hfo_mission_intent/2025-10-31/mission_intent_2025-10-31.v1.yml`
- Clarification Passes: 1â€“5 under `hfo_mission_intent/2025-10-31/`
- Blackboard: `hfo_blackboard/obsidian_synapse_blackboard.jsonl`
- Pilot runner: `scripts/crew_ai/runner.py`
- ARC swarm: `scripts/crew_ai/arc_swarm_runner.py`
- OpenRouter client: `scripts/crew_ai/llm_client.py`
- Validator: `scripts/crew_ai/validate_run.py`

---

## Plan for today (SSOT-first, then generate downstream)

### 1) Upstream SSOT (Gen22) â€” lock contracts and acceptance

- [ ] Finalize Gen22 SSOT contracts in `hfo_gem/gen_22/crew_ai_swarm_ssot_gen22.md`
  - Artifact schemas per stage include: trace_id, parent_refs, evidence_hashes, context_notes (â‰¥3 lines)
  - Lane artifacts: add explicit keys for engage: tests_green, tripwires_passed, evidence_refs_present
  - Run-level: define `quorum_report.yml` schema (validators, threshold, votes, attestation, evidence_refs)
  - Digest: define validation checklist fields (bluf_present, matrix_present, diagrams_present, diagrams_parser_safe, executive_summary_present, evidence_refs_complete)
  - Per-stage LLM defaults and transport resiliency (retry_on_empty=1; drop response_format on retry; reasoning high when supported)
  - Stigmergy: signals (labels/tags, scores) and TTL policy (evaporation)

- [ ] Export SSOT â†’ schemas for validators
  - Write `scripts/crew_ai/schemas/gen22_lane_artifacts.schema.yml`
  - Write `scripts/crew_ai/schemas/quorum_report.schema.yml`

- [ ] SSOT acceptance anchors
  - Ensure references align with `hfo_mission_intent/2025-10-31/mission_intent_2025-10-31.v1.yml` (per_stage_defaults, stigmergy, mesh quorum)
  - Update parser-safe diagrams if needed (keep labels simple)

### 2) Generate downstream â€” code and adapters

- [ ] Runner alignment (`scripts/crew_ai/runner.py`)
  - Emit traceability fields on all artifacts; include context_notes (â‰¥3)
  - Add `quorum_report.yml` at run-level; include votes and attestation
  - Add digest validation checklist section in `swarmlord_digest.md`
  - Read mission per-stage LLM defaults and resiliency flags; apply across PREY (esp. Engage)

- [ ] Validator alignment (`scripts/crew_ai/validate_run.py`)
  - Add a Gen22 mode or extend checks to enforce new schemas and digest checklist

- [ ] ARC adapter alignment (`scripts/crew_ai/arc_swarm_runner.py`)
  - Emit traceability fields and context_notes (â‰¥3); read per-stage defaults

- [ ] Stigmergy receipts
  - Add signals and TTL to blackboard receipts (append-only JSONL)

- [ ] OTEL spans per-stage
  - Emit spans for Orchestrate + each PREY phase with model, max_tokens, reasoning flags, latency_ms

### 3) Canary and validation

- [ ] Canary run: ARC validation split (limit=50, seed=42), lanes=10/max_workers=10
  - Expect: lane-level validator PASS, `quorum_report.yml` written, digest checklist PASS

### 4) Docs touch-ups

- [ ] README/AGENTS updates for Gen22
  - Document SSOT-first posture, stigmergy signals, quorum report, and digest checklist

### 5) Minimal tests

- [ ] Validator smoke tests
  - Generate tiny sample artifacts and assert PASS/FAIL on presence/absence of context_notes and evidence_refs

---

## Acceptance gates (quick)
- Lane artifacts satisfy `prey_artifacts` required fields and context_notes â‰¥ 3 lines.
- Lane-level validator PASS is recorded; run-level quorum PASS/FAIL written with attestation and votes.
- Digest validation PASS recorded (BLUF, matrix, parser-safe diagrams, executive summary, evidence_refs).
- Stigmergy receipts include signals and TTL; OTEL spans show per-stage model and token caps.

Notes
- Safety: chunk â‰¤ 200 lines, placeholder ban, receipts on material actions.
- Verify is deterministic and independent; LLM may annotate but not decide PASS/FAIL.

---

## Daily TODO Matrix (visual) â€” 2025-10-31

Legend: ðŸŸ¢ Done â€¢ ðŸŸ¡ Pending â€¢ ðŸ”´ Missing

- ðŸŸ¡ PREY orchestration (single)
  - Unify to single runner; ARC adapter executes in Engage; deprecate arc_swarm_runner.py.
- ðŸŸ¡ Provider adapters (ARC, Math, PettingZoo)
  - Move ARC into unified runner Engage; leave Math/PZ pattern-ready.
- ðŸŸ¢ Lane artifacts (traceability)
  - Per-lane YAMLs with trace_id, parent_refs, evidence_hashes, context_notes â‰¥3; hash chaining in place.
- ðŸŸ¢ Blackboard receipts (stigmergy)
  - Append-only JSONL with safety, evidence_refs, minimal stigmergy signals + TTL.
- ðŸŸ¢ Spans (OTEL-like)
  - Per-phase and engage_llm spans; analyzer detects parallelism.
- ðŸŸ¢ Deterministic quorum
  - immunizer + disruptor + verifier_aux, threshold 2/3; quorum_report.yml written.
- ðŸŸ¢ Digest (validated)
  - BLUF, matrix, parser-safe diagram, checklist present.
- ðŸŸ¢ LLM allowlist + reasoning
  - Allowlist enforced; auto reasoning for supported models; flags in spans/receipts.
- ðŸŸ¢ Transport resiliency
  - Retry-on-empty; drop response_format on retry; flags recorded.
- ðŸŸ¢ Mission intent (Gen22 aligned)
  - `provider: arc`, per-stage LLM defaults, quorum, safety, stigmergy present.
- ðŸŸ¡ Schema enforcement (validators)
  - Tighten `validate_run.py` to enforce Gen22 schemas (context_notes â‰¥3, evidence_refs complete).
- ðŸŸ¡ Centralized lanes.models selection
  - If provider=arc and lanes.models unset, default to one lane per allowlisted model.
- ðŸŸ¡ Cost fields (env-driven)
  - Propagate per-1K pricing env into ARC lane reports/digest when present.
- ðŸ”´ Lineage / merkle root
  - Emit run-level lineage JSON and optional merkle root per SSOT; future enhancement.
- ðŸ”´ Mesh quorum posture
  - Future: stigmergy mesh quorum; keep classic quorum for now.
- ðŸŸ¢ Unified docs
  - README/AGENTS updated to emphasize one PREY workflow with adapters; ARC swarm runner deprecated in docs.
